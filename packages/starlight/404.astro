---
import { getEntry } from 'astro:content';
import config from 'virtual:starlight/user-config';
import * as default404 from './components/Default404.md';
import Page from './layout/Page.astro';
import type { StarlightDocsEntry } from './utils/routing';

const { lang = 'en', dir = 'ltr', locale } = config.defaultLocale || {};
const entryMeta = { dir, lang, locale };

const fallbackEntry: StarlightDocsEntry = {
  slug: '404',
  id: '404.md' as StarlightDocsEntry['id'],
  body: default404.rawContent(),
  collection: 'docs',
  data: {
    title: 'Not found',
    template: 'splash',
    editUrl: false,
    head: [],
    hero: {
      title: '404',
      tagline: 'Houston we have a problem.',
      actions: [],
    },
  },
  render: async () => ({
    Content: default404.Content,
    headings: default404.getHeadings(),
    remarkPluginFrontmatter: {},
  }),
};

const entry = (await getEntry('docs', '404')) || fallbackEntry;
const { Content, headings } = await entry.render();
---

<Page {headings} entry={entry} slug={entry.slug} {...entryMeta} {entryMeta}>
  <Content />
</Page>
